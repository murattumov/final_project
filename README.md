# Финальный проект.  Прогнозирование цен на акции

## Оглавление
[1. Описание проекта](https://github.com/murattumov/project6/blob/master/README.md#Описание-проекта)

[2. Какой кейс решаем?](https://github.com/murattumov/project6/blob/master/README.md#Какой-кейс-решаем)

[3. Краткая информация о данных](https://github.com/murattumov/project6/blob/master/README.md#Краткая-информация-о-данных)

[4. Этапы работы над проектом](https://github.com/murattumov/project6/blob/master/README.md#Этапы-работы-над-проектом)

[5. Результат](https://github.com/murattumov/project6/blob/master/README.md#Результат)

[6. Краткая информация](https://github.com/murattumov/project6/blob/master/README.md#Краткая-информация)

### **Описание проекта**

Бизнес-задача в области биржевой торговли. Предстоит произвести возможность прогнозирования цен акций на бирже котировок для торговли трейдерами. 

### **Какой кейс решаем?**
Построить модель прогнозирования временных рядов на основе цен открытия, закрытия, высшей цены и самой низкой цены в день.

### **Краткая информация о данных**
Датасет был взят с сайта "Финам", который содержит все транзакции, произошедшие за период с 01/01/2000 по 25/08/2023 года, по компании "Сбербанк". Состоит из 5890 строк и 5 признаков: 5 числового типа. 
Признаки:


- <OPEN> — цена открытия торгового дня;
- <HIGH> — наивысшая цена за торговый день;
- <LOW> — самая низкая цена за торговый день;
- <CLOSE> — цена закрытия торгового дня;
- <VOL> — объем транзакций за торговый день

### **Этапы работы над проектом**

- Предварительный анализ и предобработка данных
  1. Замена названий признаков на названия без спецсимволов
  2. Проверка временного ряда на не естественные выбросы и перепады с помощью графика 
  ![](https://github.com/murattumov/final_project/blob/master/plotly/1.png)
  3. Удаление данных до 01.01.2008 года, т.к. в 2007 году была дробление акций и цена упала с 107000 до 109,2 рублей
  4. Интерполяция, заполняем пропущенные дни, выходные и праздничные.
  5. Анализ временного ряда на наличие тренда и сезонности, с помощью seasonal_decompose.
  ![](https://github.com/murattumov/final_project/blob/master/plotly/2.png)
  6. Анализ на коротком промежутке, чтобы увидеть сезонность.
  ![](https://github.com/murattumov/final_project/blob/master/plotly/3.png)
  7. Опреденление автокорреляции временного ряда, с помощью функции plot_acf из statsmodels
  ![](https://github.com/murattumov/final_project/blob/master/plotly/4.png)
  8. Опреденление частичной автокорреляции временного ряда, с помощью функции plot_pacf из statsmodels
  ![](https://github.com/murattumov/final_project/blob/master/plotly/5.png)
  9. Определение стационарности временного ряда с помощью теста Дики-Фуллера
  10. Приведение к стационарности с помощью дифференцирования первого порядка и определение порядка дифференцирования d=1. Из частичной автокорреляции можно определить компонентов авторегрессии p=1, а по коррелограме компонент скользящего среднего q=1
  ![](https://github.com/murattumov/final_project/blob/master/plotly/6.png)
    

- Обучение модели.
  
  1. ARIMA
    - строим модель ARIMA с полученными параметрами p=1, d=1, q=1. Получаем MSE=79.52
    - строим графики автокорреляции и частичной автокорреляции для ошибок модели.
    ![](https://github.com/murattumov/final_project/blob/master/plotly/7.png)
    - график истинных и предсказанных значений 
    ![](https://github.com/murattumov/final_project/blob/master/plotly/8.png)

  2. SARIMAX
    - логарифмуем данные, чтобы привести к гомоскедастичности
    - оценка количества сезонных различий D с помощью теста Кановы-Хансена
    - подбераем наилучшие параметры для SARIMAX с помощью пакета pmdarima: ARIMA(0,1,0)(0,0,0)[7]
    - обучение модели на лучших параметрах pmdarima. Получаем MSE=71.51
    - графики автокорреляции и частичной автокорреляции для ошибок модели
    - график истинных и предсказанных значений с доверительными интервалами
    ![](https://github.com/murattumov/final_project/blob/master/plotly/9.png)

  3. Одномерные сверточные слои
    - расчет трендовой линии болинджер бандс, дополнительного признака.
    - удаление столбца VOL и отбрасываем полученные нулевые значения при расчете BBs, BBdn, BBup
    - график временного ряда с линиями болинджер бандс
    ![](https://github.com/murattumov/final_project/blob/master/plotly/10.png)
    - отделяем тестовую часть данных, 20%
    - "раскусываем" временной ряд для подготовки к передаче на сверточную сеть с нормализацией данных
    - обучаем модель по 55 прошедшим точкам на один шаг вперед. Целеврй признак "CLOSE". Получаем MSE=15.27.
    - график корреляции истинных и предсказанных значений
    ![](https://github.com/murattumov/final_project/blob/master/plotly/11.png)
    - график распределения прогнозируемого и базового ряда
    ![](https://github.com/murattumov/final_project/blob/master/plotly/12.png)
    - график распределения прогнозируемого и базового ряда на коротком промежутке
    ![](https://github.com/murattumov/final_project/blob/master/plotly/13.png)
    
  4. Сеть с долгой краткосрочной памятью LSTM
    - обучаем модель по датасету для одномерной сверточной сети. Получаем MSE=9.86.
    - график корреляции истинных и предсказанных значений
    ![](https://github.com/murattumov/final_project/blob/master/plotly/14.png)
    - график распределения прогнозируемого и базового ряда
    ![](https://github.com/murattumov/final_project/blob/master/plotly/15.png)
    - график распределения прогнозируемого и базового ряда на коротком промежутке
    ![](https://github.com/murattumov/final_project/blob/master/plotly/16.png)
  
  
### **Результат**

Мы рассмотрели 4 вида модели для предсказания временного ряда:

    ARIMA - Получили MSE=79.52. И на графике видно что модель не смогла выявить тренд, сезонность и волатильность.
    SARIMAX - Получили MSE=71.51. Выявлена некоторая дисперсия движения цен акций, но не смогла определить амплитуду движений.
    CONV1D - Получили MSE=15.27. Хорошо предсказывает движение цены на определенное количество шагов, в данном случае один шаг. Быстро учится. Хорошо реагирует на колебание цен. Можно улучшить результат более сложными и мощными моделями.
    LSTM - Получили MSE=9.86. Прогноз цен более точен чем другие модели. Требуется больше времени на обучение. Игнорирует выбросы цен во временном ряду. График гладкий, без колебаний. Можно улучшить результат более сложными моделями. Для улучшения точности можно также добавить признаки, другими показателями популярных трендовых или индикаторных линий, характеризующими график цен.


### **Краткая информация**

****


:arrow_up:[к оглавлению](https://github.com/murattumov/final_project/blob/master/README.md#Оглавление)
